# AI è³½äº‹ä¸Šæ¶åŠ©æ‰‹ POC é–‹ç™¼è¨ˆåŠƒ

## å°ˆæ¡ˆç›®æ¨™

é€éè‡ªç„¶èªè¨€å°è©±ï¼Œå”åŠ©è³½äº‹ä¸»è¾¦æ–¹ç”¢ç”Ÿå®Œæ•´çš„ DSL JSONï¼ˆåŒ…å« FormSchemaï¼‰ï¼Œè®“å‰ç«¯å¯ä»¥å‹•æ…‹æ¸²æŸ“å ±åè¡¨å–®ã€‚

---

## ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å‰ç«¯ä»‹é¢                                 â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     Streamlit       â”‚         â”‚     Go å…§å»ºé é¢          â”‚   â”‚
â”‚  â”‚     :8501           â”‚         â”‚     :8080               â”‚   â”‚
â”‚  â”‚                     â”‚         â”‚                         â”‚   â”‚
â”‚  â”‚  â€¢ AI å°è©±å»ºç«‹è³½äº‹  â”‚         â”‚  â€¢ /        è¦å‰‡å»ºç«‹å™¨   â”‚   â”‚
â”‚  â”‚  â€¢ DSL CRUD æ“ä½œ    â”‚         â”‚  â€¢ /editor  JSON ç·¨è¼¯   â”‚   â”‚
â”‚  â”‚  â€¢ RAG æ„åœ–åˆ¤æ–·     â”‚         â”‚  â€¢ /preview è¡¨å–®é è¦½    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                  â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚              HTTP                â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Go API Server :8080                         â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Events CRUD                                                 â”‚â”‚
â”‚  â”‚  POST   /api/events              å»ºç«‹è³½äº‹                    â”‚â”‚
â”‚  â”‚  GET    /api/events              åˆ—å‡º/æœå°‹è³½äº‹               â”‚â”‚
â”‚  â”‚  GET    /api/events/:id          å–å¾—å–®ä¸€è³½äº‹                â”‚â”‚
â”‚  â”‚  PUT    /api/events/:id          æ›´æ–°è³½äº‹                    â”‚â”‚
â”‚  â”‚  DELETE /api/events/:id          åˆªé™¤è³½äº‹                    â”‚â”‚
â”‚  â”‚  POST   /api/events/:id/validate é©—è­‰ DSL                    â”‚â”‚
â”‚  â”‚  POST   /api/events/:id/calculate è¨ˆç®—åƒ¹æ ¼                   â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚  Rules (ç¾æœ‰)                                                â”‚â”‚
â”‚  â”‚  POST   /api/rules/validate      é©—è­‰ DSL èªæ³•               â”‚â”‚
â”‚  â”‚  POST   /api/rules/evaluate      è©•ä¼°è¦å‰‡                    â”‚â”‚
â”‚  â”‚  GET    /api/rules/examples      å–å¾—ç¯„ä¾‹                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      Rule Engine                             â”‚â”‚
â”‚  â”‚                (parser/evaluator/calculator)                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                      PostgreSQL                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Python Agent (RAG æ¶æ§‹)                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ChromaDB - æ„åœ–åˆ¤æ–· + Prompt ç‰‡æ®µæª¢ç´¢                       â”‚â”‚
â”‚  â”‚  â€¢ ç”¨æˆ¶è¨Šæ¯ â†’ æ„åœ–åˆ†é¡                                       â”‚â”‚
â”‚  â”‚  â€¢ æ„åœ– â†’ å°æ‡‰çš„ Prompt ç‰‡æ®µ                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  å‹•æ…‹ Prompt çµ„åˆ                                            â”‚â”‚
â”‚  â”‚  BASE_PROMPT + INTENT_PROMPT + DSL_SPEC_PROMPT              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  LangChain ReAct Agent + Tools                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“æ£§

| å±¤ç´š | æŠ€è¡“ |
|------|------|
| UI | Streamlit |
| Agent | LangChain + Claude API |
| RAG | LangChain + ChromaDB |
| ä¸»è³‡æ–™åº« | PostgreSQL (JSONB) |
| API Server | Go + Gin |
| DSL é©—è­‰/è¨ˆç®— | Go Rule Engine |
| å®¹å™¨åŒ– | Docker Compose |

---

## å°ˆæ¡ˆçµæ§‹

```
rules-engine/
â”‚
â”œâ”€â”€ cmd/rules-engine-demo/           # Go API Server
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ rules/                       # Rule Engine (ç¾æœ‰)
â”‚   â”œâ”€â”€ config/                      # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ store/                       # PostgreSQL å­˜å–å±¤
â”‚   â””â”€â”€ api/                         # Events CRUD handlers
â”‚
â”œâ”€â”€ ai-poc-python/                   # Python Agent
â”‚   â”œâ”€â”€ app.py                       # Streamlit å…¥å£
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ .env.example
â”‚   â”‚
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â”œâ”€â”€ core.py                  # Agent ä¸»é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ prompts.py               # System Promptï¼ˆå®Œæ•´ç‰ˆï¼‰
â”‚   â”‚   â””â”€â”€ prompt_fragments/        # Prompt ç‰‡æ®µï¼ˆPhase 3ï¼‰
â”‚   â”‚       â”œâ”€â”€ base.py
â”‚   â”‚       â”œâ”€â”€ intents/
â”‚   â”‚       â”‚   â”œâ”€â”€ create_event.py
â”‚   â”‚       â”‚   â”œâ”€â”€ update_event.py
â”‚   â”‚       â”‚   â””â”€â”€ ...
â”‚   â”‚       â””â”€â”€ dsl_specs/
â”‚   â”‚           â”œâ”€â”€ pricing_rules.py
â”‚   â”‚           â”œâ”€â”€ validation_rules.py
â”‚   â”‚           â””â”€â”€ form_schema.py
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ http_client.py           # HTTP Client
â”‚   â”‚   â””â”€â”€ events.py                # Events CRUD Tools
â”‚   â”‚
â”‚   â”œâ”€â”€ rag/
â”‚   â”‚   â”œâ”€â”€ intent_classifier.py     # æ„åœ–åˆ†é¡å™¨ï¼ˆPhase 3ï¼‰
â”‚   â”‚   â”œâ”€â”€ prompt_retriever.py      # Prompt æª¢ç´¢å™¨ï¼ˆPhase 3ï¼‰
â”‚   â”‚   â”œâ”€â”€ embeddings.py            # ChromaDB æ“ä½œ
â”‚   â”‚   â””â”€â”€ documents/               # æ„åœ–å®šç¾©æ–‡ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ settings.py
â”‚
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”‚
â”œâ”€â”€ examples/                        # DSL ç¯„ä¾‹
â””â”€â”€ docs/                            # æ–‡ä»¶
```

---

## é–‹ç™¼éšæ®µ

### Phase 1: Go API Server æ“´å…… âœ… å·²å®Œæˆ

**ç›®æ¨™**ï¼šæ–°å¢ Events CRUD API + PostgreSQL + Docker ç’°å¢ƒ

| ä»»å‹™ | ç‹€æ…‹ |
|------|------|
| docker-compose.yml | âœ… |
| Dockerfile (Go) | âœ… |
| internal/config | âœ… |
| internal/store | âœ… |
| internal/api | âœ… |
| æ•´åˆåˆ° main.go | âœ… |

---

### Phase 2: Python Agent åŸºç¤ âœ… å·²å®Œæˆ

**ç›®æ¨™**ï¼šå»ºç«‹ Streamlit + LangChain Agent åŸºç¤æ¶æ§‹

| ä»»å‹™ | ç‹€æ…‹ |
|------|------|
| å°ˆæ¡ˆçµæ§‹ & requirements.txt | âœ… |
| config/settings.py | âœ… |
| tools/http_client.py | âœ… |
| tools/events.py (7 å€‹ Tools) | âœ… |
| agent/core.py | âœ… |
| agent/prompts.py (åŸºç¤ç‰ˆ) | âœ… |
| app.py (Streamlit UI) | âœ… |
| Dockerfile (Python) | âœ… |

---

### Phase 2.5: ä¿®æ­£å•é¡Œ + å®Œå–„ System Prompt âœ… å·²å®Œæˆ

**ç›®æ¨™**ï¼šè®“åŸºæœ¬åŠŸèƒ½å¯ä»¥æ­£å¸¸é‹ä½œ

| ä»»å‹™ | ç‹€æ…‹ |
|------|------|
| 2.5.1 ä¿®æ­£ `create_react_agent` åƒæ•¸éŒ¯èª¤ | âœ… |
| 2.5.2 è±å¯Œ System Promptï¼ŒåŠ å…¥å®Œæ•´ DSL è¦æ ¼èˆ‡ç¯„ä¾‹ | âœ… |
| 2.5.3 æ¸¬è©¦åŸºæœ¬å°è©±åŠŸèƒ½ï¼ˆå»ºç«‹ã€ä¿®æ”¹ã€æŸ¥è©¢è³½äº‹ï¼‰ | âœ… |
| 2.5.4 Preview é é¢æ•´åˆï¼ˆæ”¯æ´ `?event_id=xxx` åƒæ•¸ï¼‰ | âœ… |

**é©—æ”¶æ¨™æº–**ï¼š
- âœ… Agent å¯æ­£ç¢ºç”Ÿæˆ DSL
- âœ… å»ºç«‹è³½äº‹åŠŸèƒ½æ­£å¸¸é‹ä½œ
- âœ… Preview é é¢å¯é€é URL åƒæ•¸è¼‰å…¥è³½äº‹

---

### Phase 3: RAG æ„åœ–åˆ¤æ–· + å‹•æ…‹ Prompt â³ é€²è¡Œä¸­

**ç›®æ¨™**ï¼šä½¿ç”¨ RAG åšæ„åœ–åˆ¤æ–·ï¼Œæ ¹æ“šæ„åœ–å‹•æ…‹çµ„åˆ Prompt

#### æ¶æ§‹

```
User Message
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ChromaDB æ„åœ–åˆ¤æ–·                â”‚
â”‚                                         â”‚
â”‚  "æˆ‘æƒ³å»ºç«‹è³½äº‹" â†’ intent: create_event  â”‚
â”‚  "ä¿®æ”¹åƒ¹æ ¼"     â†’ intent: update_event  â”‚
â”‚  "æŸ¥è©¢è³½äº‹"     â†’ intent: search_event  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å‹•æ…‹ Prompt çµ„åˆ                 â”‚
â”‚                                         â”‚
â”‚  BASE_PROMPT                            â”‚
â”‚  + INTENT_PROMPTS[intent]               â”‚
â”‚  + DSL_SPEC_PROMPTS[related_specs]      â”‚
â”‚                                         â”‚
â”‚  (update_event æœƒæ ¹æ“šé—œéµå­—è¼‰å…¥å°æ‡‰è¦æ ¼)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LangChain Agent åŸ·è¡Œ            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä»»å‹™

| ä»»å‹™ | ç‹€æ…‹ |
|------|------|
| 3.1 æ‹†åˆ† System Prompt ç‚ºå¤šå€‹ç‰‡æ®µ | âœ… |
| 3.2 å®šç¾©æ„åœ–é¡åˆ¥èˆ‡å°æ‡‰çš„ Prompt ç‰‡æ®µ | âœ… |
| 3.3 ChromaDB è¨­ç½® (docker-compose) | âœ… |
| 3.4 å¯¦ä½œæ„åœ–åˆ†é¡å™¨ (intent_classifier.py) | âœ… |
| 3.5 å¯¦ä½œ Prompt æª¢ç´¢èˆ‡çµ„åˆ (prompt_retriever.py) | âœ… |
| 3.6 æ•´åˆåˆ° agent/core.py | âœ… |
| 3.7 Streamlit UI é¡¯ç¤º RAG ç‹€æ…‹ | âœ… |
| 3.8 **Embedding æ”¹ç”¨ Gemini API** | â³ é€²è¡Œä¸­ |
| 3.9 æ¸¬è©¦èˆ‡å„ªåŒ– | ğŸ”œ å¾…åŸ·è¡Œ |

#### æ„åœ–åˆ†é¡ï¼ˆç°¡åŒ–ç‚º 8 é¡ï¼‰

| æ„åœ– | è§¸ç™¼è©ç¯„ä¾‹ | éœ€è¦çš„ Prompt ç‰‡æ®µ |
|------|-----------|-------------------|
| create_event | å»ºç«‹è³½äº‹ã€æ–°å¢æ´»å‹• | CREATE_EVENT + æ‰€æœ‰ DSL_SPECS |
| update_event | ä¿®æ”¹åƒ¹æ ¼ã€æ”¹è²»ç”¨ã€æ”¹æ¬„ä½ | UPDATE_EVENT + é—œéµå­—åµæ¸¬å°æ‡‰è¦æ ¼ |
| search_event | æŸ¥è©¢ã€æ‰¾ã€åˆ—å‡º | SEARCH_EVENT |
| get_event | æŸ¥çœ‹è©³ç´°ã€å–å¾—è³‡æ–™ | SEARCH_EVENT |
| delete_event | åˆªé™¤ã€ç§»é™¤ | DELETE_EVENT |
| calculate_price | ç®—åƒ¹æ ¼ã€é è¦½è²»ç”¨ | CALCULATE_PRICE |
| preview_event | é è¦½è¡¨å–® | PREVIEW_EVENT |
| general | å…¶ä»–ä¸€èˆ¬å°è©± | åƒ… BASE_PROMPT |

#### update_event é—œéµå­—åµæ¸¬

ç•¶æ„åœ–ç‚º `update_event` æ™‚ï¼Œæœƒåµæ¸¬è¨Šæ¯ä¸­çš„é—œéµå­—ä¾†æ±ºå®šè¼‰å…¥å“ªäº› DSL è¦æ ¼ï¼š

| é—œéµå­—é¡åˆ¥ | é—œéµå­— | è¼‰å…¥çš„è¦æ ¼ |
|-----------|--------|-----------|
| pricing | åƒ¹æ ¼ã€è²»ç”¨ã€å ±åè²»... | PRICING_RULES + CONDITIONS |
| discount | å„ªæƒ ã€æŠ˜æ‰£ã€æ—©é³¥... | PRICING_RULES + CONDITIONS |
| form | æ¬„ä½ã€è¡¨å–®... | FORM_SCHEMA |
| validation | é©—è­‰ã€é™åˆ¶... | VALIDATION_RULES + CONDITIONS |

#### å·²å®Œæˆçš„æª”æ¡ˆ

```
ai-poc-python/
â”œâ”€â”€ agent/prompt_fragments/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py                      # æ ¸å¿ƒäººè¨­ + èƒ½åŠ› + DSL åŸºç¤
â”‚   â”œâ”€â”€ intents/
â”‚   â”‚   â”œâ”€â”€ create_event.py          # å»ºç«‹æµç¨‹
â”‚   â”‚   â”œâ”€â”€ update_event.py          # ä¿®æ”¹æµç¨‹
â”‚   â”‚   â”œâ”€â”€ search_event.py          # æœå°‹èªªæ˜
â”‚   â”‚   â”œâ”€â”€ delete_event.py          # åˆªé™¤ç¢ºèª
â”‚   â”‚   â”œâ”€â”€ calculate_price.py       # åƒ¹æ ¼è¨ˆç®—
â”‚   â”‚   â””â”€â”€ preview_event.py         # é è¦½èªªæ˜
â”‚   â””â”€â”€ dsl_specs/
â”‚       â”œâ”€â”€ overview.py              # DSL çµæ§‹æ¦‚è¦½ (å¿…è¦/é¸æ“‡æ¬„ä½)
â”‚       â”œâ”€â”€ pricing_rules.py         # åƒ¹æ ¼è¦å‰‡è¦æ ¼
â”‚       â”œâ”€â”€ validation_rules.py      # é©—è­‰è¦å‰‡è¦æ ¼
â”‚       â”œâ”€â”€ form_schema.py           # è¡¨å–®æ¬„ä½è¦æ ¼
â”‚       â””â”€â”€ conditions.py            # æ¢ä»¶èªæ³•è¦æ ¼
â”‚
â”œâ”€â”€ rag/
â”‚   â”œâ”€â”€ intent_documents.py          # æ„åœ–å®šç¾© + ç¯„ä¾‹ + é—œéµå­—
â”‚   â”œâ”€â”€ intent_classifier.py         # ChromaDB æ„åœ–åˆ†é¡å™¨
â”‚   â””â”€â”€ prompt_retriever.py          # å‹•æ…‹ Prompt çµ„åˆ
```

#### å¾…è§£æ±ºå•é¡Œ

**Embedding æ¨¡å‹ä¸‹è¼‰ç·©æ…¢**

- åŸå› ï¼š`all-MiniLM-L6-v2` (79MB) ä¸‹è¼‰é€Ÿåº¦åªæœ‰ ~10KB/s
- è§£æ±ºæ–¹æ¡ˆï¼šæ”¹ç”¨ Google Gemini Embedding API
- éœ€è¦æ–°å¢ï¼š
  - `GOOGLE_API_KEY` ç’°å¢ƒè®Šæ•¸
  - `rag/embeddings.py` - Gemini Embedding å°è£
  - ä¿®æ”¹ `intent_classifier.py` ä½¿ç”¨ Gemini

**é©—æ”¶æ¨™æº–**ï¼š
- RAG æ„åœ–åˆ¤æ–·æº–ç¢ºç‡ > 80%
- Prompt æ ¹æ“šæ„åœ–å‹•æ…‹çµ„åˆ
- Token ä½¿ç”¨é‡æ¯”å®Œæ•´ Prompt æ¸›å°‘ 30%+

---

### Phase 4: å®Œå–„åŠŸèƒ½

**ç›®æ¨™**ï¼šå„ªåŒ–èˆ‡é¡å¤–åŠŸèƒ½

| ä»»å‹™ | èªªæ˜ |
|------|------|
| 4.1 | Web Search toolï¼ˆæœå°‹é¡ä¼¼è³½äº‹åƒè€ƒï¼‰ |
| 4.2 | å°è©±æµç¨‹å„ªåŒ–ï¼ˆæ›´å¥½çš„å¼•å°ï¼‰ |
| 4.3 | éŒ¯èª¤è™•ç†æ”¹å–„ |
| 4.4 | UI å„ªåŒ–ï¼ˆè¡¨å–®é è¦½æ•´åˆï¼‰ |
| 4.5 | æ€§èƒ½æ¸¬è©¦èˆ‡å„ªåŒ– |

---

## Agent Tools ç¸½è¦½

### Events CRUD (å‘¼å« Go API)

| Tool | API Endpoint | èªªæ˜ |
|------|--------------|------|
| `search_events` | GET /api/events?q=... | æœå°‹è³½äº‹ |
| `get_event` | GET /api/events/:id | å–å¾—å®Œæ•´ DSL |
| `create_event` | POST /api/events | å»ºç«‹æ–°è³½äº‹ |
| `update_event` | PUT /api/events/:id | æ›´æ–°è³½äº‹ |
| `delete_event` | DELETE /api/events/:id | åˆªé™¤è³½äº‹ |
| `validate_event` | POST /api/events/:id/validate | é©—è­‰ DSL |
| `calculate_price` | POST /api/events/:id/calculate | è¨ˆç®—å ±åè²»ç”¨ |

---

## Prompt é–‹ç™¼ç­–ç•¥

### éšæ®µæ¼”é€²

```
Phase 2.5: å®Œæ•´ System Promptï¼ˆå–®ä¸€å¤§æª”æ¡ˆï¼‰
    â”‚
    â”‚ åŠŸèƒ½é©—è­‰å®Œæˆå¾Œ
    â–¼
Phase 3: æ‹†åˆ†ç‚º Prompt ç‰‡æ®µ
    â”‚
    â”‚ â€¢ BASE_PROMPTï¼ˆå›ºå®šï¼‰
    â”‚ â€¢ INTENT_PROMPTSï¼ˆæŒ‰æ„åœ–ï¼‰
    â”‚ â€¢ DSL_SPEC_PROMPTSï¼ˆæŒ‰ DSL çµæ§‹ï¼‰
    â”‚
    â–¼
Phase 3: RAG æ„åœ–åˆ¤æ–· + å‹•æ…‹çµ„åˆ
```

### Prompt ç‰‡æ®µè¨­è¨ˆ

```
prompt_fragments/
â”œâ”€â”€ base.py                 # åŸºç¤äººè¨­ã€å°è©±é¢¨æ ¼
â”œâ”€â”€ intents/
â”‚   â”œâ”€â”€ create_event.py     # å»ºç«‹è³½äº‹çš„å¼•å°æµç¨‹
â”‚   â”œâ”€â”€ update_event.py     # ä¿®æ”¹è³½äº‹çš„æµç¨‹
â”‚   â”œâ”€â”€ search_event.py     # æœå°‹èªªæ˜
â”‚   â””â”€â”€ ...
â””â”€â”€ dsl_specs/
    â”œâ”€â”€ pricing_rules.py    # pricing_rules å®Œæ•´è¦æ ¼ + ç¯„ä¾‹
    â”œâ”€â”€ validation_rules.py # validation_rules å®Œæ•´è¦æ ¼ + ç¯„ä¾‹
    â”œâ”€â”€ form_schema.py      # form_schema å®Œæ•´è¦æ ¼ + ç¯„ä¾‹
    â””â”€â”€ discount.py         # æŠ˜æ‰£è¦å‰‡èªªæ˜
```

---

## Docker Compose æœå‹™

```yaml
services:
  postgres:      # PostgreSQL è³‡æ–™åº« (:5432)
  api:           # Go API Server (:8080)
  streamlit:     # Python Agent UI (:8501)
  chromadb:      # RAG å‘é‡è³‡æ–™åº« (:8000) - Phase 3
```

---

## ç’°å¢ƒè®Šæ•¸

### Go API Server
```
DATABASE_URL=postgres://postgres:postgres@postgres:5432/rules_engine?sslmode=disable
SERVER_PORT=8080
```

### Python Agent
```
GO_API_URL=http://api:8080
ANTHROPIC_API_KEY=sk-ant-...
MODEL_NAME=claude-sonnet-4-20250514
CHROMA_HOST=chromadb
CHROMA_PORT=8000
GOOGLE_API_KEY=AIza...    # Gemini Embedding API (Phase 3)
```

---

## å·²ç¢ºèªäº‹é …

- [x] LLM é¸æ“‡ï¼šClaude API
- [x] è³‡æ–™åº«ï¼šPostgreSQL
- [x] RAG ç”¨é€”ï¼šæ„åœ–åˆ¤æ–· + å‹•æ…‹ Prompt çµ„åˆ
- [x] Embeddingï¼šGoogle Gemini Embedding API
- [ ] Web Search æœå‹™ï¼šå¾…å®š

---

## æ¥ä¸‹ä¾†çš„å·¥ä½œ (Phase 3 å‰©é¤˜)

### 1. Gemini Embedding æ•´åˆ ğŸ”œ

```python
# éœ€è¦æ–°å¢/ä¿®æ”¹çš„æª”æ¡ˆï¼š

# 1. ai-poc-python/requirements.txt
# æ–°å¢ï¼šgoogle-generativeai>=0.3.0

# 2. ai-poc-python/config/settings.py
# æ–°å¢ï¼šgoogle_api_key: str = ""

# 3. ai-poc-python/.env.example
# æ–°å¢ï¼šGOOGLE_API_KEY=

# 4. ai-poc-python/rag/embeddings.py (æ–°æª”æ¡ˆ)
class GeminiEmbeddingFunction:
    """ChromaDB compatible embedding function using Gemini API."""

    def __call__(self, input: list[str]) -> list[list[float]]:
        # å‘¼å« Gemini embedding API
        pass

# 5. ai-poc-python/rag/intent_classifier.py
# ä¿®æ”¹ï¼šä½¿ç”¨ GeminiEmbeddingFunction å–ä»£é è¨­ embedding
```

### 2. æ¸¬è©¦ RAG åŠŸèƒ½

- [ ] ç¢ºèªæ„åœ–åˆ†é¡æ­£ç¢ºé‹ä½œ
- [ ] ç¢ºèªå‹•æ…‹ Prompt æ­£ç¢ºçµ„åˆ
- [ ] æ¸¬è©¦å„ç¨®å°è©±å ´æ™¯
- [ ] é©—è­‰ Token ä½¿ç”¨é‡æ¸›å°‘

### 3. Phase 4ï¼ˆå¯é¸å„ªåŒ–ï¼‰

- UI å„ªåŒ–
- éŒ¯èª¤è™•ç†æ”¹å–„
- æ€§èƒ½æ¸¬è©¦
